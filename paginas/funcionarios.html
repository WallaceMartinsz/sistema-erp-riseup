<!DOCTYPE html>
<html>

<head>
  <title>ERP Devcyber | Funcionários</title>

  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="stylesheet" type="text/css"
    href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.2.0/css/bootstrap.min.css" />
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.13.4/css/dataTables.bootstrap5.min.css" />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" />
  <link href="../assets/css/funcionario-cliente.css" rel="stylesheet" />
  <link rel="shortcut icon" type="image/jpg" href="../assets/logo.png"/>
</head>

<body>
  <header class="sticky-top">
    <nav class="navbar navbar-expand-md bg-dark">
      <div class="container-fluid">
        <a class="navbar-brand" href="../index.html">
          <img src="../assets/logo.png" alt="Logo" width="80" height="auto" />
        </a>
        <button class="navbar-toggler btn-orange" type="button" data-bs-toggle="collapse"
          data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
          aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav me-auto">
            <li class="nav-item">
              <a class="nav-link" href="pdv.html">Venda</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="estoque.html">Estoque</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="financeiro.html">Financeiro</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="funcionarios.html">Funcionário</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="cliente.html">Cliente</a>
            </li>
          </ul>
          <form action="#" method="post" id="formPesquisa" class="d-flex" role="search">
            <input class="barraPesquisa form-control me-2" type="search" placeholder="Pesquisa" aria-label="Pesquisa"
              style="width: 75%" />
            <button class="btn" type="button">
              <i class="bi bi-search"></i>
            </button>
          </form>
        </div>
      </div>
    </nav>
  </header>

  <main class="mt-3">
    <div class="container-fluid px-3">
      <h2>Gerenciamento de Funcionários</h2>

      <div class="mb-2">
        <button class="btn btn-orange" type="button" data-bs-toggle="modal" data-bs-target="#cadastroFuncionario">
          <i class="bi bi-person-fill-add"></i>
        </button>

        <div class="modal fade" id="cadastroFuncionario" data-bs-backdrop="static" data-bs-keyboard="false"
          tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
          <div class="modal-dialog modal-md modal-dialog-centered modal-dialog-scrollable">
            <div class="modal-content bg-dark text-white-50">
              <div class="modal-header">
                <h1 class="modal-title fs-5" id="staticBackdropLabel">
                  Cadastro de Funcionário
                </h1>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                  aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <form id="formCadastrar">
                  <div class="mb-3">
                    <label for="Nome" class="col-form-label">Nome:</label>
                    <input type="text" name="Nome" class="form-control" id="Nome" />
                  </div>
                  <div class="mb-3">
                    <label for="CPF" class="col-form-label">CPF:</label>
                    <input type="text" name="CPF" class="form-control" id="CPF" />
                  </div>
                  <div class="mb-3">
                    <label for="Email" class="col-form-label">Email:</label>
                    <input type="text" name="Email" class="form-control" id="Email" />
                  </div>
                  <div class="mb-3">
                    <label for="Telefone" class="col-form-label">Telefone:</label>
                    <input type="text" name="Telefone" class="form-control" id="Telefone" />
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="Cargo" id="cargo1" value="Caixa" />
                    <label class="form-check-label" for="cargo1">Caixa</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="Cargo" id="cargo2" value="Estoque" />
                    <label class="form-check-label" for="cargo2">Estoque</label>
                  </div>
                  <div class="form-check">
                    <input class="form-check-input" type="radio" name="Cargo" id="cargo3" value="Gerente" />
                    <label class="form-check-label" for="cargo3">Gerente</label>
                  </div>
                </form>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                  Cancelar
                </button>
                <button type="button" class="btn btn-primary" onclick="cadastrar();">
                  Cadastrar
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="modal fade" id="atualizarFuncionario" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
        aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog modal-md modal-dialog-centered modal-dialog-scrollable">
          <div class="modal-content bg-dark text-white-50">
            <div class="modal-header">
              <h1 class="modal-title fs-5" id="staticBackdropLabel">
                Atualizar Funcionário
              </h1>
              <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"
                aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <form id="formAtualizar">
                <div class="mb-3">
                  <label for="nomeAtualizar" class="col-form-label">Nome:</label>
                  <input type="text" name="nomeAtualizar" class="form-control" id="nomeAtualizar" />
                </div>
                <div class="mb-3">
                  <label for="cpfAtualizar" class="col-form-label">CPF:</label>
                  <input type="text" name="cpfAtualizar" class="form-control" id="cpfAtualizar" />
                </div>
                <div class="mb-3">
                  <label for="emailAtualizar" class="col-form-label">Email:</label>
                  <input type="text" name="emailAtualizar" class="form-control" id="emailAtualizar" />
                </div>
                <div class="mb-3">
                  <label for="telefoneAtualizar" class="col-form-label">Telefone:</label>
                  <input type="text" name="telefoneAtualizar" class="form-control" id="telefoneAtualizar" />
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="cargo1Atualizar" id="cargo1Atualizar"
                    value="Caixa" />
                  <label class="form-check-label" for="cargo1Atualizar">Caixa</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="cargo2Atualizar" id="cargo2Atualizar"
                    value="Estoque" />
                  <label class="form-check-label" for="cargo2Atualizar">Estoque</label>
                </div>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="cargo3Atualizar" id="cargo3Atualizar"
                    value="Gerente" />
                  <label class="form-check-label" for="cargo3Atualizar">Gerente</label>
                </div>
              </form>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                Cancelar
              </button>
              <button type="button" class="btn btn-primary" onclick="atualizar();">
                Atualizar
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="table-responsive bg-dark text-white rounded p-2">
      <table id="tabelaFuncionarios" class="table table-dark table-bordered">
        <thead>
          <tr>
            <th>Nome</th>
            <th>CPF</th>
            <th>Cargo</th>
            <th>Telefone</th>
            <th>Email</th>
            <th></th>
          </tr>
        </thead>
        <tbody class="">
        </tbody>
      </table>
    </div>
    </div>
  </main>
</body>
<script type="text/javascript" src="https://code.jquery.com/jquery-3.5.1.js"></script>
<script type="text/javascript" src="../assets/js/dataTables.js"></script>
<script type="text/javascript" src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap5.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>
<script type="text/javascript">

  $(document).ready(function () {
    $("#tabelaFuncionarios").DataTable();
  });

  var array = [];

  function cadastrar() {
    var form = $("#formCadastrar")[0];
    var formData = new FormData(form);

    if (formData.get("CPF") == "" || formData.get("CPF") == null) {
      alert('Campo CPF obrigatório para cadastro de funcionário!')
    } else {
      var objeto = {};

      if (formData.get("Nome") != "" || formData.get("Nome") != null) {
        objeto.nome = formData.get('Nome');
      }
      if (formData.get("CPF") != "" || formData.get("CPF") != null) {
        objeto.cpf = formData.get('CPF');
      }
      if (formData.get("Cargo") != "" || formData.get("Cargo") != null) {
        objeto.cargo = formData.get('Cargo');
      }
      if (formData.get("Telefone") != "" || formData.get("Telefone") != null) {
        objeto.telefone = formData.get('Telefone');
      }
      if (formData.get("Email") != "" || formData.get("Email") != null) {
        objeto.email = formData.get('Email');
      }

      if (Object.keys(objeto).length >= 3) {
        objeto.botao = '<button class="btn-editar" type="button" onclick="abrirPopUpAtualizar()";><i class="bi bi-plus"></i></button>';
        array.push(objeto); // Adicione o objeto no array
        $('#tabelaFuncionarios').DataTable().row.add(Object.values(objeto)).draw();
        console.log('oi')
      }

      $('#Nome').val('');
      $('#CPF').val('');
      $('#Telefone').val('');
      $('#Cargo').val('');
      $('#Email').val('');

      $('#cadastroFuncionario').modal('hide');
    }


  }

  function atualizar() {
    var form = $('#formAtualizar')[0];
    var formData = new FormData(form);

    var novoNome = formData.get('nomeAtualizar');
    var novoCPF = formData.get('cpfAtualizar');
    var novoTelefone = formData.get('telefoneAtualizar');
    var novoCargo1 = formData.get('cargo1Atualizar');
    var novoCargo2 = formData.get('cargo2Atualizar');
    var novoCargo3 = formData.get('cargo3Atualizar');
    var novoEmail = formData.get('emailAtualizar');

    //Percorrendo o array para achar o funcionário para atualizar
    for (var i = 0; i < array.length; i++) {
      if (novoNome !== "" && novoNome !== null) {
        array[i].nome = novoNome;
      }
      if (novoCPF !== "" && novoCPF !== null) {
        array[i].cpf = novoCPF;
      }
      if (novoTelefone !== "" && novoTelefone !== null) {
        array[i].telefone = novoTelefone;
      }
      if (novoCargo1 !== "" && novoCargo1 !== null) {
        array[i].cargo = novoCargo1;
      }
      if (novoCargo2 !== "" && novoCargo2 !== null) {
        array[i].cargo = novoCargo2;
      }
      if (novoCargo3 !== "" && novoCargo3 !== null) {
        array[i].cargo = novoCargo3;
      }
      if (novoEmail !== "" && novoEmail !== null) {
        array[i].email = novoEmail;
      }
      break;
    }

    atualizarTabela();

    $('#nomeAtualizar').val('');
    $('#cpfAtualizar').val('');
    $('#telefoneAtualizar').val('');
    $('#emailAtualizar').val('');
    $('#cargo1Atualizar').val('');
    $('#cargo2Atualizar').val('');
    $('#cargo3Atualizar').val('');

    $('#atualizarFuncionario').modal('hide');

  }

  function atualizarTabela() {
    // Limpar a tabela existente
    $('#tabelaFuncionarios').DataTable().clear().draw();

    // Adicionar os novos dados na tabela
    for (var i = 0; i < array.length; i++) {
      $('#tabelaFuncionarios').DataTable().row.add(Object.values(array[i]));
    }

    // Redesenha a tabela com os novos dados
    $('#tabelaFuncionarios').DataTable().draw();
  }

  function abrirPopUpAtualizar() {
    $('#atualizarFuncionario').modal('show');
  }

</script>
<script type="text/javascript" src="../assets/js/funcionario-cliente.js"></script>

</html>